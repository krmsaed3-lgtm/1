<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <title>اختبار جلب عنوان المحفظة</title>
  <style>
    body { font-family: Arial; background:#111; color:#fff; padding:30px }
    button { padding:12px 20px; font-size:16px }
    .box { margin-top:20px; padding:15px; background:#222; border-radius:8px }
    .error { color:#ff6b6b }
    .ok { color:#4cd137 }
  </style>
</head>
<body>

<h2>اختبار مباشر – جلب عنوان محفظة من السيرفر</h2>

<p>هذه الصفحة فقط للاختبار، بدون نظام الإيداع.</p>

<button onclick="getAddress()">جلب عنوان محفظة</button>

<div id="result" class="box">—</div>

<script src="sb-config.js"></script>

<script>
async function getAddress() {
  const box = document.getElementById('result');
  box.innerHTML = 'جاري الطلب...';

  try {
    const r = await fetch(
      SB_CONFIG.url + '/functions/v1/get_new_address',
      {
        method: 'POST',
        headers: {
          ...SB_CONFIG.headers()
        }
      }
    );

    const data = await r.json();

    if (!r.ok) {
      box.innerHTML = '<span class="error">خطأ:</span> ' + JSON.stringify(data);
      return;
    }

    box.innerHTML =
      '<span class="ok">تم بنجاح</span><br>' +
      '<b>العنوان:</b><br>' +
      data.address;

  } catch (e) {
    box.innerHTML = '<span class="error">فشل الاتصال:</span> ' + e.message;
  }
}
</script>

</body>
</html>
