<script>
let allRecords = [];

function loadRecords() {
  try {
    allRecords = JSON.parse(localStorage.getItem('records') || '[]');
  } catch {
    allRecords = [];
  }
  applyFilters();
}

function render(list) {
  const box = document.getElementById('billsContainer');

  if (!list.length) {
    box.className = 'empty-state';
    box.textContent = 'No records yet';
    return;
  }

  box.className = 'bill-list';
  box.innerHTML = '';

  list.forEach(r => {
    const item = document.createElement('div');
    item.className = 'bill-item';

    item.innerHTML = `
      <div class="bill-main-row">
        <span class="bill-type">${r.type}</span>
        <span class="bill-amount">${r.amount} ${r.currency}</span>
      </div>
      <div class="bill-sub-row">
        <span class="bill-status">${r.status}</span>
        <span class="bill-time">${r.createdAt.replace('T',' ').slice(0,19)}</span>
      </div>
    `;

    box.appendChild(item);
  });
}

function applyFilters() {
  const start = document.getElementById('startDate').value;
  const end = document.getElementById('endDate').value;

  let out = allRecords.filter(r => {
    const d = new Date(r.createdAt);
    if (start && d < new Date(start)) return false;
    if (end && d > new Date(end + 'T23:59:59')) return false;
    return true;
  });

  render(out);
}

document.querySelector('.btn-confirm').onclick = applyFilters;
document.querySelector('.btn-reset').onclick = () => {
  startDate.value = '';
  endDate.value = '';
  render(allRecords);
};

loadRecords();
setInterval(loadRecords, 1000);
</script>
