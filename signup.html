<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport"/>
<title>Sign Up</title>

<!-- Flag CDN (preconnect only) -->
<link rel="preconnect" href="https://flagcdn.com">

<style>
    :root {
      --page-bg: #05070b;
      --card-bg: #05070b;
      --field-bg: #17202d;
      --prefix-bg: #0e131b;
      --border-color: #343b48;
      --text-main: #ffffff;
      --text-muted: #7b8593;
      --primary-gradient-start: #27C6FF;
      --primary-gradient-end: #46EEAC;
      --link-color: #1ea7ff;
      --error-color: #ff4d4f;
    }

    *,
    *::before,
    *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", system-ui, sans-serif;
      background-color: var(--page-bg);
      color: var(--text-main);
    }

    .page {
      min-height: 100vh;
      background-color: var(--page-bg);
      color: var(--text-main);
    }

    .hero {
      position: relative;
      width: 100%;
      overflow: hidden;
    }

    .hero img.hero-bg {
      display: block;
      width: 100%;
      height: auto;
    }

    .hero-button {
      position: absolute;
      top: 14px;
      width: 32px;
      height: 32px;
      border-radius: 999px;
      background: rgba(5, 10, 18, 0.8);
      backdrop-filter: blur(6px);
      display: flex;
      align-items: center;
      justify-content: center;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .hero-button.back {
      left: 12px;
    }

    .hero-button.support {
      right: 12px;
    }

    .back-arrow {
      width: 10px;
      height: 10px;
      border-left: 2px solid #ffffff;
      border-bottom: 2px solid #ffffff;
      transform: rotate(45deg);
    }

    .support-icon {
      width: 20px;
      height: 20px;
      border-radius: 999px;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .support-icon img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .content {
      padding: 16px;
    }

    .title {
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 12px;
    }

    .field {
      margin-bottom: 14px;
    }

    .field-label {
      font-size: 13px;
      color: var(--text-main);
      margin-bottom: 6px;
    }

    .phone-row {
      display: flex;
      gap: 8px;
    }

    .prefix-box {
      min-width: 96px;
      height: 48px;
      border-radius: 8px;
      padding: 0 12px;
      background-color: var(--prefix-bg);
      border: 1px solid var(--border-color);
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 14px;
      color: #ffffff;
      cursor: pointer;
    }

    /* عرض محتوى الزر أفقيًا ومحاذاة الوسط، gap أصغر حتى لا يبدو العلم بعيدًا */
    .prefix-box span {
      display: inline-flex;
      align-items: center;
      gap: 4px; /* تم تقليل الفراغ هنا */
      color: #FFFFFF;
    }

    .arrow-down {
      width: 8px;
      height: 8px;
      border-left: 2px solid #ffffffd9;
      border-bottom: 2px solid #ffffffd9;
      transform: rotate(-45deg);
      margin-left: 6px;
    }

    .input-field {
      width: 100%;
      height: 48px;
      border-radius: 8px;
      background-color: var(--field-bg);
      border: 1px solid var(--border-color);
      padding: 0 16px;
      color: var(--text-main);
      font-size: 14px;
      outline: none;
    }

    .input-field::placeholder {
      color: var(--text-muted);
    }

    .password-wrapper {
      position: relative;
      margin-bottom: 4px;
    }

    .password-wrapper input {
      width: 100%;
      padding-right: 44px;
    }

    .toggle-password {
      position: absolute;
      top: 50%;
      right: 14px;
      transform: translateY(-50%);
      width: 28px;
      height: 28px;
      border-radius: 50%;
      border: 1px solid rgba(255, 255, 255, 0.2);
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(10, 15, 24, 0.8);
      padding: 0;
      transition: transform 0.12s ease, box-shadow 0.12s ease;
      cursor: pointer;
    }

    .toggle-password:active {
      transform: translateY(-50%) scale(0.94);
    }

    .toggle-password .eye-icon {
      width: 14px;
      height: 14px;
      display: block;
    }

    .verification-row {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .verification-display {
      min-width: 120px;
      height: 48px;
      border-radius: 8px;
      border: 1px solid var(--border-color);
      background-color: var(--prefix-bg);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 10px 0 14px;
      font-size: 16px;
      letter-spacing: 2px;
    }

    #generated-code {
      font-weight: 600;
    }

    .refresh-code-btn {
      border: none;
      background: transparent;
      padding: 0;
      margin-left: 8px;
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }

    .refresh-code-btn img {
      width: 18px;
      height: 18px;
      display: block;
    }

    .helper-text {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 4px;
    }

    .login-btn {
      width: 100%;
      height: 48px;
      border-radius: 8px;
      border: none;
      outline: none;
      font-size: 16px;
      font-weight: 500;
      color: #000000d9;
      background: linear-gradient(90deg, #27C6FF 0%, #46EEAC 100%);
      margin-top: 10px;
      margin-bottom: 14px;
      text-align: center;
      line-height: 48px;
      cursor: pointer;
      transition: opacity 0.2s ease, transform 0.1s ease;
    }

    .login-btn.login-btn--disabled {
      background: linear-gradient(90deg, #0B2F3B 0%, #101B20 100%);
      color: rgba(255, 255, 255, 0.45);
      opacity: 1;
      cursor: not-allowed;
    }

    .login-btn.login-btn--enabled:active {
      transform: translateY(1px);
    }

    .terms {
      font-size: 11px;
      color: var(--text-muted);
      line-height: 1.5;
      margin-bottom: 18px;
    }

    .terms a {
      color: var(--link-color);
      text-decoration: none;
    }

    .signup {
      font-size: 12px;
      color: var(--text-muted);
    }

    .signup a {
      color: var(--link-color);
      text-decoration: none;
      margin-left: 4px;
    }

    .signup a:active,
    .signup a:focus-visible {
      text-decoration: underline;
    }

    @media (min-width: 480px) {
      .page {
        max-width: 480px;
        margin: 0 auto;
      }
    }

    .area-modal {
      position: fixed;
      inset: 0;
      display: none;
      z-index: 999;
    }

    .area-modal.open {
      display: block;
    }

    .area-modal-mask {
      position: absolute;
      inset: 0;
      background: rgba(0, 0, 0, 0.6);
    }

    .area-modal-panel {
      position: absolute;
      left: 0;
      right: 0;
      bottom: 0;
      background: #0E131B;
      border-radius: 16px 16px 0 0;
      padding: 10px 12px 16px;
      max-height: 45vh;
      display: flex;
      flex-direction: column;
    }

    .area-modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 4px 4px 8px;
      font-size: 14px;
      color: #ffffff;
    }

    .area-modal-header-title {
      font-weight: 500;
    }

    .area-close {
      border: none;
      outline: none;
      background: transparent;
      color: rgba(255, 255, 255, 0.75);
      font-size: 20px;
      padding: 0 4px;
      cursor: pointer;
    }

    .area-search {
      margin: 4px 0 8px;
    }

    .area-search-input {
      width: 100%;
      height: 40px;
      border-radius: 8px;
      border: 1px solid rgba(255, 255, 255, 0.12);
      background: #0A0F18;
      color: #ffffff;
      padding: 0 12px;
      font-size: 13px;
    }

    .area-search-input::placeholder {
      color: rgba(255, 255, 255, 0.35);
    }

    .area-list {
      flex: 1;
      overflow-y: auto;
      padding-top: 4px;
    }

    .area-section-title {
      font-size: 12px;
      color: rgba(255, 255, 255, 0.5);
      padding: 4px 4px 6px;
    }

    .country-option {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 10px;
      font-size: 13px;
      color: #ffffff;
      cursor: pointer;
    }

    .country-option:hover {
      background-color: rgba(255, 255, 255, 0.06);
    }

    .country-option-name {
      max-width: 70%;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .country-option-code {
      color: rgba(255, 255, 255, 0.65);
      margin-left: 8px;
      white-space: nowrap;
    }

    @media (min-width: 768px) {
      .area-modal-panel {
        left: 50%;
        transform: translateX(-50%);
        max-width: 420px;
        border-radius: 16px;
      }
    }

    .input-error {
      border-color: var(--error-color) !important;
      box-shadow: 0 0 0 1px rgba(255, 77, 79, 0.35);
    }

    .toast-message {
      position: fixed;
      left: 50%;
      top: 220px;
      transform: translate(-50%, -10px);
      padding: 8px 14px;
      border-radius: 999px;
      background: rgba(255, 77, 79, 0.96);
      color: #ffffff;
      font-size: 13px;
      line-height: 1.4;
      max-width: 90%;
      text-align: center;
      z-index: 1200;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s ease-out, transform 0.2s ease-out;
      white-space: nowrap;
      text-overflow: ellipsis;
      overflow: hidden;
    }

    .toast-message.toast-visible {
      opacity: 1;
      transform: translate(-50%, 0);
    }

    /* flag أصغر ليناسب المربع */
    .flag {
      width: 14px;
      height: 10px;
      vertical-align: middle;
      margin-right: 6px;
      border-radius: 2px;
      object-fit: cover;
      flex-shrink: 0;
    }

  </style>
</head>
<body>
<div class="page">
<header class="hero">
<img alt="Background" class="hero-bg" src="images/login-bg-h5.png"/>
<button class="hero-button back" type="button">
<span class="back-arrow"></span>
</button>
<button class="hero-button support" type="button">
<span class="support-icon">
<img alt="Support" src="images/customer-service.png"/>
</span>
</button>
</header>
<main class="content">
<h1 class="title">Sign Up</h1>
<div class="field">
<div class="field-label">Phone</div>
<div class="phone-row">
<!-- زر اختيار البلد مع span لادخال العلم والنداء بشكل أفقي -->
<button id="prefixBtn" class="prefix-box" type="button">
<span id="prefixValue">+386</span>
<span class="arrow-down"></span>
</button>
<input autocomplete="tel" class="input-field" id="phone-input" placeholder="Enter phone" type="tel"/>
</div>
</div>
<div class="field">
<div class="field-label">Password</div>
<div class="password-wrapper">
<input autocomplete="new-password" class="input-field" id="password-input" placeholder="At least 8 characters" type="password"/>
<button class="toggle-password" data-target="password-input" type="button">
<img alt="Toggle password visibility" class="eye-icon" src="images/password-eye-closed.png"/>
</button>
</div>
</div>
<div class="field">
<div class="field-label">Confirm Password</div>
<div class="password-wrapper">
<input autocomplete="new-password" class="input-field" id="confirm-password-input" placeholder="Confirm password" type="password"/>
<button class="toggle-password" data-target="confirm-password-input" type="button">
<img alt="Toggle password visibility" class="eye-icon" src="images/password-eye-closed.png"/>
</button>
</div>
</div>
<div class="field">
<div class="field-label">Invitation Code</div>
<input class="input-field" id="invitation-code-input" placeholder="Enter invitation code" type="text"/>
</div>
<div class="field">
<div class="field-label">Verification Code</div>
<div class="verification-row">
<input class="input-field" id="verification-code-input" placeholder="Enter verification code" type="text"/>
<div class="verification-display">
<span id="generated-code">000000</span>
<button aria-label="Refresh verification code" class="refresh-code-btn" type="button">
<img alt="Refresh" src="images/reseticon-DvFfY0b1.png"/>
</button>
</div>
</div>
<div class="helper-text">Enter the code shown on the right.</div>
</div>
<button class="login-btn login-btn--disabled sign-up-btn" type="button">
        Sign Up
      </button>
<p class="terms">
        By signing up, I agree to the
        <a href="service-agreement.html">Service Agreement</a>
        and
        <a href="privacy-policy.html">Privacy Policy</a>.
      </p>
<p class="signup">
        Already have an account?
        <a href="login.html">Log In</a>
</p>
</main>
</div>
<div aria-hidden="true" class="area-modal">
<div class="area-modal-mask"></div>
<div class="area-modal-panel">
<div class="area-modal-header">
<span class="area-modal-header-title">Select area code</span>
<button class="area-close" type="button">×</button>
</div>
<div class="area-search">
<input class="area-search-input" placeholder="Please search for the international dialing code" type="text"/>
</div>
<div class="area-list">
<!-- populated by JS -->
</div>
</div>
</div>
<div class="toast-message" id="form-toast"></div>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>
document.addEventListener("DOMContentLoaded", function () {
  // ---- Nav buttons ----
  var backBtn = document.querySelector(".hero-button.back");
  if (backBtn) {
    backBtn.addEventListener("click", function () {
      if (window.history.length > 1) window.history.back();
      else window.location.href = "mine.html";
    });
  }
  var supportBtn = document.querySelector(".hero-button.support");
  if (supportBtn) supportBtn.addEventListener("click", function () {
    window.location.href = "help-center.html";
  });

  // ---- Elements ----
  var phoneInput = document.getElementById("phone-input");
  var passwordInput = document.getElementById("password-input");
  var confirmPasswordInput = document.getElementById("confirm-password-input");
  var invitationInput = document.getElementById("invitation-code-input");
  var verificationInput = document.getElementById("verification-code-input");
  var signUpBtn = document.querySelector(".sign-up-btn");
  var prefixBox = document.querySelector(".prefix-box");
  var prefixValue = document.getElementById("prefixValue");
  var prefixBtn = document.getElementById("prefixBtn");

  var generatedCodeSpan = document.getElementById("generated-code");
  var refreshCodeBtn = document.querySelector(".refresh-code-btn");
  var toastEl = document.getElementById("form-toast");

  var areaModal = document.querySelector(".area-modal");
  var areaMask = document.querySelector(".area-modal-mask");
  var areaPanel = document.querySelector(".area-modal-panel");
  var areaList = document.querySelector(".area-list");
  var areaClose = document.querySelector(".area-close");
  var areaSearchInput = document.querySelector(".area-search-input");

  // ---- Countries (with iso) — only data change, no layout change ----
  var countries = [
    { name: "Slovenia", code: "+386", iso: "si", common: true },
    { name: "Panama", code: "+507", iso: "pa", common: true },
    { name: "Syria", code: "+963", iso: "sy", common: true },
    { name: "Republic of Lebanon", code: "+961", iso: "lb", common: true },
    { name: "Cyprus", code: "+357", iso: "cy", common: true },
    { name: "Saudi Arabia", code: "+966", iso: "sa", common: true },

    { name: "United Arab Emirates", code: "+971", iso: "ae" },
    { name: "Qatar", code: "+974", iso: "qa" },
    { name: "Kuwait", code: "+965", iso: "kw" },
    { name: "Bahrain", code: "+973", iso: "bh" },
    { name: "Oman", code: "+968", iso: "om" },
    { name: "Jordan", code: "+962", iso: "jo" },
    { name: "Iraq", code: "+964", iso: "iq" },
    { name: "Turkey", code: "+90", iso: "tr" },
    { name: "Egypt", code: "+20", iso: "eg" },
    { name: "Morocco", code: "+212", iso: "ma" },
    { name: "Algeria", code: "+213", iso: "dz" },
    { name: "Tunisia", code: "+216", iso: "tn" },
    { name: "Libya", code: "+218", iso: "ly" },
    { name: "Yemen", code: "+967", iso: "ye" },
    { name: "United States", code: "+1", iso: "us" },
    { name: "Canada", code: "+1", iso: "ca" },
    { name: "United Kingdom", code: "+44", iso: "gb" },
    { name: "Germany", code: "+49", iso: "de" },
    { name: "France", code: "+33", iso: "fr" },
    { name: "Italy", code: "+39", iso: "it" },
    { name: "Spain", code: "+34", iso: "es" },
    { name: "Russia", code: "+7", iso: "ru" },
    { name: "India", code: "+91", iso: "in" },
    { name: "Pakistan", code: "+92", iso: "pk" },
    { name: "Afghanistan", code: "+93", iso: "af" },
    { name: "Iran", code: "+98", iso: "ir" },
    { name: "China", code: "+86", iso: "cn" },
    { name: "Hong Kong", code: "+852", iso: "hk" },
    { name: "Japan", code: "+81", iso: "jp" },
    { name: "South Korea", code: "+82", iso: "kr" },
    { name: "Singapore", code: "+65", iso: "sg" },
    { name: "Malaysia", code: "+60", iso: "my" },
    { name: "Indonesia", code: "+62", iso: "id" },
    { name: "Philippines", code: "+63", iso: "ph" },
    { name: "Thailand", code: "+66", iso: "th" },
    { name: "Vietnam", code: "+84", iso: "vn" },
    { name: "Australia", code: "+61", iso: "au" },
    { name: "New Zealand", code: "+64", iso: "nz" },
    { name: "Brazil", code: "+55", iso: "br" },
    { name: "Argentina", code: "+54", iso: "ar" },
    { name: "Mexico", code: "+52", iso: "mx" },
    { name: "South Africa", code: "+27", iso: "za" },
    { name: "Nigeria", code: "+234", iso: "ng" },
    { name: "Kenya", code: "+254", iso: "ke" },
    { name: "Ethiopia", code: "+251", iso: "et" },
    { name: "Sweden", code: "+46", iso: "se" },
    { name: "Norway", code: "+47", iso: "no" },
    { name: "Denmark", code: "+45", iso: "dk" },
    { name: "Netherlands", code: "+31", iso: "nl" },
    { name: "Belgium", code: "+32", iso: "be" },
    { name: "Switzerland", code: "+41", iso: "ch" },
    { name: "Austria", code: "+43", iso: "at" },
    { name: "Greece", code: "+30", iso: "gr" },
    { name: "Portugal", code: "+351", iso: "pt" },
    { name: "Ireland", code: "+353", iso: "ie" }
  ];

  // build country list (only place we inject <img class="flag"> — no CSS/layout change)
  function buildCountryOptions(list, filter) {
    if (!areaList) return;
    areaList.innerHTML = "";

    var q = (filter || "").toLowerCase();

    var common = countries.filter(function (c) {
      if (!c.common) return false;
      if (!q) return true;
      return c.name.toLowerCase().includes(q) || c.code.indexOf(filter) !== -1;
    });

    var others = countries.filter(function (c) {
      if (c.common) return false;
      if (!q) return true;
      return c.name.toLowerCase().includes(q) || c.code.indexOf(filter) !== -1;
    });

    function appendSection(title, items) {
      if (!items.length) return;
      var titleEl = document.createElement('div');
      titleEl.className = 'area-section-title';
      titleEl.textContent = title;
      areaList.appendChild(titleEl);

      items.forEach(function (c) {
        var item = document.createElement('div');
        item.className = 'country-option';
        var nameSpan = document.createElement('span');
        nameSpan.className = 'country-option-name';
        // inject flag + name (keeps layout and styles intact)
        nameSpan.innerHTML = '<img class="flag" src="https://flagcdn.com/w20/' + c.iso + '.png"> ' + c.name;
        var codeSpan = document.createElement('span');
        codeSpan.className = 'country-option-code';
        codeSpan.textContent = c.code;
        item.appendChild(nameSpan);
        item.appendChild(codeSpan);
        item.addEventListener('click', function () {
          if (prefixValue) {
            prefixValue.innerHTML = '<img class="flag" src="https://flagcdn.com/w20/' + c.iso + '.png"> ' + c.code;
          }
          closeAreaModal();
        });
        areaList.appendChild(item);
      });
    }

    appendSection("Commonly used countries", common);
    appendSection("All countries/regions", others);
  }

  function openAreaModal() {
    if (!areaModal) return;
    areaModal.classList.add('open');
    if (areaSearchInput) areaSearchInput.value = '';
    buildCountryOptions(countries, '');
  }

  function closeAreaModal() {
    if (!areaModal) return;
    areaModal.classList.remove('open');
  }

  // attach events (use prefixBtn first for reliability)
  if (prefixBtn) prefixBtn.addEventListener('click', openAreaModal);
  else if (prefixBox) prefixBox.addEventListener('click', openAreaModal);

  if (areaMask) areaMask.addEventListener('click', closeAreaModal);
  if (areaClose) areaClose.addEventListener('click', closeAreaModal);
  if (areaSearchInput) {
    areaSearchInput.addEventListener('input', function () {
      buildCountryOptions(countries, areaSearchInput.value || '');
    });
  }

  // set initial prefix flag for +386 if found (non-breaking)
  try {
    if (prefixValue) {
      for (var i = 0; i < countries.length; i++) {
        if (countries[i].code === "+386") {
          prefixValue.innerHTML = '<img class="flag" src="https://flagcdn.com/w20/' + countries[i].iso + '.png"> +386';
          break;
        }
      }
    }
  } catch (e) { /* silent fallback */ }

  // ---- existing helpers / logic (unchanged behavior) ----
  function showToast(msg) {
    if (!toastEl) { alert(msg); return; }
    toastEl.textContent = msg;
    toastEl.classList.add("toast-visible");
    clearTimeout(showToast._t);
    showToast._t = setTimeout(function () {
      toastEl.classList.remove("toast-visible");
    }, 2200);
  }

  function getPhoneDigits(v) {
    return String(v || "").replace(/\D/g, "");
  }

  function generateVerificationCode() {
    var code = Math.floor(100000 + Math.random() * 900000).toString();
    generatedCodeSpan.textContent = code;
    return code;
  }

  function setBtnEnabled(enabled) {
    if (!signUpBtn) return;
    signUpBtn.classList.toggle("login-btn--disabled", !enabled);
    signUpBtn.classList.toggle("login-btn--enabled", enabled);
  }

  function validateBasic() {
    var digits = getPhoneDigits(phoneInput && phoneInput.value);
    var p1 = passwordInput ? passwordInput.value : "";
    var p2 = confirmPasswordInput ? confirmPasswordInput.value : "";
    var inv = invitationInput ? invitationInput.value.trim() : "";
    return digits.length >= 5 && p1.length >= 8 && p1 === p2 && inv.length >= 4;
  }

  document.querySelectorAll(".toggle-password").forEach(function (btn) {
    btn.addEventListener("click", function () {
      var id = btn.getAttribute("data-target");
      var input = document.getElementById(id);
      if (!input) return;
      var isPass = input.type === "password";
      input.type = isPass ? "text" : "password";
      var img = btn.querySelector("img");
      if (img) img.src = isPass ? "images/password-eye-open.png" : "images/password-eye-closed.png";
    });
  });

  try {
    var params = new URLSearchParams(window.location.search || "");
    var code = (params.get("code") || "").trim();
    if (code && invitationInput) invitationInput.value = code;
  } catch (e) {}

  var generatedCode = generateVerificationCode();
  if (refreshCodeBtn) {
    refreshCodeBtn.addEventListener("click", function () {
      generatedCode = generateVerificationCode();
    });
  }

  ["input", "change"].forEach(function (evt) {
    [phoneInput, passwordInput, confirmPasswordInput, invitationInput, verificationInput].forEach(function (el) {
      if (!el) return;
      el.addEventListener(evt, function () { setBtnEnabled(validateBasic()); });
    });
  });
  setBtnEnabled(validateBasic());

  if (signUpBtn) {
    signUpBtn.addEventListener("click", async function () {
      var digits = getPhoneDigits(phoneInput && phoneInput.value);
      var p1 = passwordInput ? passwordInput.value : "";
      var p2 = confirmPasswordInput ? confirmPasswordInput.value : "";
      var invCode = (invitationInput ? invitationInput.value : "").trim();
      var userCode = (verificationInput ? verificationInput.value : "").trim();

      if (!digits) return showToast("Please enter phone.");
      if (p1.length < 8) return showToast("Password must be at least 8 characters.");
      if (p1 !== p2) return showToast("Passwords do not match.");
      if (!invCode) return showToast("Please enter invitation code.");
      if (userCode !== generatedCode) return showToast("Verification code incorrect.");

      signUpBtn.disabled = true;

      try {
        var areaCodeVal = prefixValue ? String(prefixValue.textContent || "").trim() : "";
        var phoneFull = (window.ExaAuth && window.ExaAuth.fullPhone) ? window.ExaAuth.fullPhone(areaCodeVal, digits) : (areaCodeVal + digits);

        if (!window.ExaAuth || typeof window.ExaAuth.registerWithInvite !== "function") {
          throw new Error("Auth service not loaded.");
        }

        var created = await window.ExaAuth.registerWithInvite({
          phone: phoneFull,
          usedInviteCode: invCode
        });

        try {
          if (created && created.id) localStorage.setItem("pw:" + created.id, p1);
        } catch (e) {}

        window.location.href = "my-assets.html";
      } catch (err) {
        console && console.error && console.error("Signup error:", err);
        showToast((err && err.message) ? err.message : "Signup failed. Please try again.");
        signUpBtn.disabled = false;
      }

    });
  }

});
</script>
<!-- Load Supabase configuration first -->
<script src="sb-config.js"></script>
<!-- Authentication helpers -->
<script src="auth.js"></script>
<!-- Enforce login redirects on protected pages -->
<script src="common-nav.js"></script>
</body>
</html>
