<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
<title>Records</title>
<style>
:root{
  --bg:#05080d;--panel:#0e1524;--stroke:rgba(255,255,255,.08);
  --text:#e9eef6;--muted:#9aa7bd;--btn:#20d0b6;--btn2:#2a3447;
  --r:18px
}
*{box-sizing:border-box}
body{margin:0;background:linear-gradient(180deg,#04060a,#05080d);font-family:system-ui;color:var(--text);
display:flex;justify-content:center;padding:16px}
.phone{width:min(420px,96vw);border-radius:28px;border:1px solid var(--stroke);overflow:hidden}
.top{display:flex;align-items:center;justify-content:space-between;padding:14px}
.icon{width:40px;height:40px;border-radius:14px;border:1px solid var(--stroke);
display:grid;place-items:center;cursor:pointer}
.panel{background:var(--panel);border-top:1px solid var(--stroke);padding:14px}
.row{display:grid;grid-template-columns:1fr 22px 1fr;gap:10px}
.input{width:100%;padding:12px;border-radius:14px;background:#05080d;border:1px solid var(--stroke);
color:var(--text)}
.btnrow{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:12px}
.btn{height:44px;border-radius:16px;border:0;font-weight:700;cursor:pointer}
.reset{background:var(--btn2);color:var(--text)}
.confirm{background:var(--btn);color:#021815}
.list{padding:10px}
.item{border-bottom:1px solid var(--stroke);padding:12px}
.main{display:flex;justify-content:space-between}
.sub{display:flex;justify-content:space-between;font-size:12px;color:var(--muted);margin-top:4px}
.empty{padding:20px;text-align:center;color:var(--muted)}
</style>
</head>
<body>
<div class="phone">
  <div class="top">
    <div class="icon" onclick="history.back()">‹</div>
    <b>Records</b>
    <div class="icon" id="reload">⟳</div>
  </div>

  <div class="panel">
    <div class="row">
      <input id="start" class="input" type="date" value="2025-12-26">
      <div style="text-align:center;font-size:12px;color:var(--muted)">to</div>
      <input id="end" class="input" type="date" value="2025-12-26">
    </div>

    <div class="btnrow">
      <button class="btn reset" id="reset">Reset</button>
      <button class="btn confirm" id="confirm">Confirm</button>
    </div>
  </div>

  <div id="list" class="list">
    <div class="empty" id="empty">Loading...</div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
const supabase = window.supabase.createClient(
  "https://daaxfvepnujsuftzcfcv.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRhYXhmdmVwbnVqc3VmdHpjZmN2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY0NTUxMzMsImV4cCI6MjA4MjAzMTEzM30.WjpjKmK2j7omDIH2n_Q7gzC7Ei-KinARMF2FlUj4qyA"
);

const list=document.getElementById('list');
const empty=document.getElementById('empty');
const start=document.getElementById('start');
const end=document.getElementById('end');

function uid(){
 return localStorage.getItem('sb_user_id_v1')
     || localStorage.getItem('user_id')
     || localStorage.getItem('uid')
     || '';
}

async function load(){
 const user=uid();
 if(!user){empty.textContent='No user';return}
 empty.style.display='block';
 empty.textContent='Loading...';
 list.innerHTML='<div class="empty" id="empty">Loading...</div>';

 let q=supabase.from('bills')
  .select('kind,amount,status,created_at')
  .eq('user_id',user)
  .order('created_at',{ascending:false});

 if(start.value) q=q.gte('created_at', start.value+'T00:00:00');
 if(end.value) q=q.lte('created_at', end.value+'T23:59:59');

 const res=await q;
 if(res.error){empty.textContent=res.error.message;return}

 const rows=res.data||[];
 if(!rows.length){empty.textContent='No records';return}

 list.innerHTML='';
 rows.forEach(r=>{
  const d=r.created_at.replace('T',' ').slice(0,19);
  const el=document.createElement('div');
  el.className='item';
  el.innerHTML=`
   <div class="main">
    <b>${r.kind}</b>
    <b>${Number(r.amount).toFixed(8)} USDT</b>
   </div>
   <div class="sub">
    <span>${r.status}</span>
    <span>${d}</span>
   </div>`;
  list.appendChild(el);
 });
}

document.getElementById('confirm').onclick=load;
document.getElementById('reload').onclick=load;
document.getElementById('reset').onclick=()=>{start.value='2025-12-26';end.value='2025-12-26';load()};

load();
</script>
</body>
</html>
